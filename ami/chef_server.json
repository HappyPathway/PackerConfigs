{
  "variables": {
    "source_ami": "ami-43a15f3e",
    "instance_type": "t2.micro",
    "chef_validation_key": "{{env `CHEF_VALIDATION_KEY` }}",
    "chef_client_name": "{{env `CHEF_CLIENT_NAME` }}",
    "chef_server_url": "{{env `CHEF_SERVER_URL`}}",
    "working_dir": "{{env `PWD`}}",
    "home_dir": "{{env `HOME`}}"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "us-east-1",
      "source_ami": "{{user `source_ami`}}",
      "instance_type": "{{user `instance_type`}}",
      "ssh_username": "ubuntu",
      "ami_name": "ChefServer",
      "run_tags": {
        "Name": "Packer-ChefServer"
      },
      "tags": {
        "role": "ChefServer"
      }
    }
  ],
  "provisioners": [
    {
        "type": "chef-client",
        "server_url": "{{user `chef_server_url`}}",
        "chef_environment": "_default",
        "run_list": "recipe[chef_server]",
        "ssl_verify_mode": "verify_none",
        "validation_key_path": "{{user `chef_validation_key` }}",
        "validation_client_name": "{{user `chef_client_name` }}"
    }
  ]
}
